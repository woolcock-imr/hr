<div id=D__ID>
    <section id=form_container__ID bp=576 style='display:flow-root;'>
    	<div id=header__ID>
    		Notes
    	</div>
    	<form id=F__ID>
			<div>
				<div w='100|100'>
					<span>Contents</span>
					<!--<textarea name=Contents style='height:300px'></textarea>-->
					<div id=Contents__ID name=Contents contenteditable="true" style='min-height:300px'></div>
				</div>
			</div>
			<br>
			<div>
				<div w='100|100'>
					<button id=submit__ID class="btn btn-secondary">Submit</button>
				</div>
			</div>
    	</form>
    </section>
	VmInclude:__COMPONENT__/m/model.01.html
    <script>
    	function F__ID(){
    		//-------------------------------------
			VmInclude:__COMPONENT__/f/form.01.js
			new ResizeObserver($vm.responsive).observe(form_container__ID);
			m.storage_type='s0';
    		//-------------------------------------
			var old_m_load=m.load;
			m.load=function(){
				old_m_load();
				if(m.input && m.input.record){
					var c=m.input.record.Data.Contents;
					c=c.replace(/<div>/g,'@#@%1');
					c=c.replace(/<\/div>/g,'@#@%2');
					c=c.replace(/<img/g,'@#@%3');
					c=$vm.text(c);
					c=c.replace(/@#@%1/g,'<div>');
					c=c.replace(/@#@%2/g,'</div>');
					c=c.replace(/@#@%3/g,'<img');
					$('#F__ID div[name=Contents]').html(c);
				}
			}
            m.before_submit=function(data,index){
				data.Contents=$('#F__ID div[name=Contents]').html();
				$vm["_sys_refresh_"+m.parent_table]=1; 		//force parent module to refresh
				if(m.input!=undefined){
					index.I2=m.input.UID; 					//parent UID -> I2, build relation
				}
				return true;
            }
			//-------------------------------------
			var dom=document.getElementById("Contents__ID");
			dom.onpaste = (e) => {
				/*
			let cbPayload = [...(e.clipboardData || e.originalEvent.clipboardData).items];     // Capture the ClipboardEvent's eventData payload as an array
				cbPayload = cbPayload.filter(i => /image/.test(i.type));                       // Strip out the non-image bits
			
			//if(!cbPayload.length || cbPayload.length === 0) return false;                      // If no image was present in the collection, bail.
			
			let reader = new FileReader();                                                     // Instantiate a FileReader...
			reader.onload = (e) =>{
				//contentTarget.innerHTML = `<img src="${e.target.result}">`; // ... set its onLoad to render the event target's payload
				console.log(e.target.result)
			}
			reader.readAsDataURL(cbPayload[0].getAsFile());                                    // ... then read in the pasteboard image data as Base64
				*/

				var c=e.target.result;
console.log(e)				
console.log(e.clipboardData.getData("text"))				

/*

				c=c.replace(/<img/g,'@#@%3');
				c=$vm.text(c);
				c=c.replace(/@#@%3/g,'<img');
alert(c);				
				var sel, range;
				if (window.getSelection) {
					sel = window.getSelection();
					if (sel.getRangeAt && sel.rangeCount) {
						range = sel.getRangeAt(0);
						range.deleteContents();
						range.insertNode( document.createTextNode(c) );
					}
				} else if (document.selection && document.selection.createRange) {
					document.selection.createRange().text = c;
				}
				*/
			};
			//-------------------------------------
    	}
    </script>
    <style>
        #form_container__ID{
            max-width:800px;
        }
		VmInclude:__CURRENT_PATH__style.css
		VmInclude:__COMPONENT__/f/form.01.css
		#F__ID div[name=Contents] div{
			padding:0;
			margin:0;
		}
    </style>
</div>
